@model List<DRM.Models.Requests>

@{
    Layout = "~/Views/Shared/_Layout_2.cshtml";
    ViewData["Title"] = "View Requests";
}

<div class="wrapper wrapper-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>Pending Requests</h5>
                    </div>
                    <div class="ibox-content color-primary">
                        <div class="scrollable-requests">
                            @if (!Model.Any())
                            {
                                <p class="text-muted text-center">No pending requests.</p>
                            }
                            else
                            {
                                @foreach (var request in Model)
                                {
                                    var fileType = request.VideoId.HasValue ? "Video" :
                                    request.AudioId.HasValue ? "Audio" :
                                    request.PdfId.HasValue ? "PDF" : "Unknown";

                                    var fileName = request.VideoFile?.Name ??
                                    request.AudioFile?.Name ??
                                    request.PdfFile?.Name ?? "Unknown";
                                    
                                    <div class="request-box colour-success">
                                        <div class="request-text">
                                            <strong>@request.User.UserName</strong> has requested access to a <strong>@fileType</strong> file: <span class="text-info">@fileName</span>
                                        </div>
                                        <div class="request-actions">
                                            <form method="post" action="@Url.Action("AcceptRequest", "AssignUser")" style="display:inline;">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="requestId" value="@request.Id" />
                                                <button type="submit" class="btn btn-success btn-sm">Accept</button>
                                            </form>
                                            <form method="post" action="@Url.Action("DeclineRequest", "AssignUser")" style="display:inline;">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="requestId" value="@request.Id" />
                                                <button type="submit" class="btn btn-danger btn-sm">Decline</button>
                                            </form>
                                        </div>
                                    </div>

                                    <br />
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        /* ✅ Scrollable requests container */
        .scrollable-requests {
            max-height: 400px; /* Set max height */
            overflow-y: auto; /* Enable vertical scrollbar */
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
        }

        /* ✅ Request box styling */
        .request-box {
            background-color: #007bff; /* Primary color */
            color: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ✅ Text and actions styling */
        .request-text {
            flex-grow: 1;
            padding-right: 10px;
        }

        .request-actions {
            display: flex;
            gap: 8px;
        }

            /* ✅ Make sure buttons don't stretch */
            .request-actions button {
                min-width: 80px;
            }

        /* ✅ Hide page scrollbar */
        body {
            overflow: hidden;
        }
    </style>
}
